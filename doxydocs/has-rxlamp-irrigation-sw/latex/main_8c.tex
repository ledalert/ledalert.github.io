\hypertarget{main_8c}{}\section{src/main.c File Reference}
\label{main_8c}\index{src/main.\+c@{src/main.\+c}}


Irrigation controller main file.  


{\ttfamily \#include \char`\"{}math.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}ws2812\+\_\+macro.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}usart\+\_\+macro.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}dma\+\_\+macro.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}led\+\_\+macro.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}timer\+\_\+macro.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}systick\+\_\+macro.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}adc.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}time.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}filter.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}irrigation.\+h\char`\"{}}\\*
Include dependency graph for main.\+c\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{main_8c__incl}
\end{center}
\end{figure}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define {\bfseries H\+W\+\_\+\+P\+R\+E\+\_\+\+I\+N\+I\+T}(call,  obj)
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hypertarget{main_8c_aa423cbe2bea57704cca655826b2338c1}{}{\bfseries G\+P\+I\+O\+\_\+\+P\+O\+R\+T\+\_\+\+I\+N\+S\+T\+A\+N\+C\+E} (G\+P\+I\+O\+\_\+\+P\+A, G\+P\+I\+O\+A, R\+C\+C\+\_\+\+G\+P\+I\+O\+A)\label{main_8c_aa423cbe2bea57704cca655826b2338c1}

\item 
\hypertarget{main_8c_abebbe5a8f2ebcfc52329af1a2a452c32}{}{\bfseries G\+P\+I\+O\+\_\+\+P\+O\+R\+T\+\_\+\+I\+N\+S\+T\+A\+N\+C\+E} (G\+P\+I\+O\+\_\+\+P\+B, G\+P\+I\+O\+B, R\+C\+C\+\_\+\+G\+P\+I\+O\+B)\label{main_8c_abebbe5a8f2ebcfc52329af1a2a452c32}

\item 
\hypertarget{main_8c_af239d1be6128c2cf9470dddd0736206d}{}{\bfseries G\+P\+I\+O\+\_\+\+P\+I\+N\+\_\+\+N\+O\+C\+O\+N\+F} (Serial\+\_\+tx,\&G\+P\+I\+O\+\_\+\+P\+A, G\+P\+I\+O\+\_\+\+U\+S\+A\+R\+T1\+\_\+\+T\+X)\label{main_8c_af239d1be6128c2cf9470dddd0736206d}

\item 
\hypertarget{main_8c_a4e07380dc740e8c8320b9ecf6fc1bd6d}{}{\bfseries U\+S\+A\+R\+T\+\_\+8\+N1} (Serial, U\+S\+A\+R\+T1, R\+C\+C\+\_\+\+U\+S\+A\+R\+T1, 921600, 0,\&Serial\+\_\+tx)\label{main_8c_a4e07380dc740e8c8320b9ecf6fc1bd6d}

\item 
\hypertarget{main_8c_ab6e1a812398e2960f55569f1becf22f8}{}{\bfseries D\+M\+A\+\_\+\+I\+N\+S\+T\+A\+N\+C\+E} (Dma, D\+M\+A1, R\+C\+C\+\_\+\+D\+M\+A1)\label{main_8c_ab6e1a812398e2960f55569f1becf22f8}

\item 
\hypertarget{main_8c_a2aeeaba0bf350894e16dca95c3433371}{}{\bfseries G\+P\+I\+O\+\_\+\+P\+I\+N\+\_\+\+N\+O\+C\+O\+N\+F} (Status\+L\+E\+D\+\_\+pin,\&G\+P\+I\+O\+\_\+\+P\+B, G\+P\+I\+O15)\label{main_8c_a2aeeaba0bf350894e16dca95c3433371}

\item 
\hypertarget{main_8c_a62bc4a3e73a3bda284d20e2d99aa9c3e}{}{\bfseries T\+I\+M\+E\+R\+\_\+\+N\+O\+C\+O\+N\+F} (Status\+L\+E\+D\+\_\+timer, T\+I\+M1, R\+C\+C\+\_\+\+T\+I\+M1)\label{main_8c_a62bc4a3e73a3bda284d20e2d99aa9c3e}

\item 
\hypertarget{main_8c_a65e33b62baadd843fc4d336930ffc80a}{}{\bfseries D\+M\+A\+\_\+\+C\+H\+A\+N\+N\+E\+L\+\_\+\+N\+O\+C\+O\+N\+F} (Status\+L\+E\+D\+\_\+dma,\&Dma, D\+M\+A\+\_\+\+C\+H\+A\+N\+N\+E\+L6)\label{main_8c_a65e33b62baadd843fc4d336930ffc80a}

\item 
\hypertarget{main_8c_a4b692da9c42d4defd8814f963d1d2da0}{}{\bfseries T\+I\+M\+E\+R\+\_\+\+C\+C\+R\+\_\+\+N\+O\+C\+O\+N\+F} (Status\+L\+E\+D\+\_\+pwm,\&Status\+L\+E\+D\+\_\+timer, T\+I\+M\+\_\+\+O\+C3\+N,\&Status\+L\+E\+D\+\_\+dma)\label{main_8c_a4b692da9c42d4defd8814f963d1d2da0}

\item 
\hypertarget{main_8c_ad3c78d4a91a7027ea6ec309a0fdf1a4d}{}{\bfseries W\+S2812\+\_\+\+S\+I\+M\+P\+L\+E\+\_\+\+C\+O\+N\+F} (Status\+L\+E\+D,\&Status\+L\+E\+D\+\_\+pin,\&Status\+L\+E\+D\+\_\+pwm, 1)\label{main_8c_ad3c78d4a91a7027ea6ec309a0fdf1a4d}

\item 
\hypertarget{main_8c_ac01d8360f2847c41f234b2d6333879cc}{}{\bfseries S\+Y\+S\+T\+I\+C\+K\+\_\+\+A\+U\+T\+O\+\_\+\+C\+O\+N\+F\+I\+G} (Systick, 1000)\label{main_8c_ac01d8360f2847c41f234b2d6333879cc}

\item 
\hypertarget{main_8c_a1f98adee46907f4bd29dc153ce25dcb7}{}{\bfseries G\+A\+M\+M\+A\+\_\+\+L\+U\+T\+\_\+8\+\_\+8\+\_\+\+E\+\_\+\+I\+N\+S\+T\+A\+N\+C\+E} (L\+E\+D\+\_\+\+Gamma)\label{main_8c_a1f98adee46907f4bd29dc153ce25dcb7}

\item 
void \hyperlink{main_8c_aabae29cd362c0001a2b417c9206cb330}{hw\+\_\+init\+\_\+state} (enum \hyperlink{hw_8h_a3c02952100e7d051b77cdf060ca0ba9b}{hw\+\_\+init\+\_\+state} state)
\begin{DoxyCompactList}\small\item\em Init hardware. \end{DoxyCompactList}\item 
void \hyperlink{main_8c_afdd94f850b193691f1bfc60c724b542a}{sys\+\_\+tick\+\_\+handler} (void)
\begin{DoxyCompactList}\small\item\em Systick I\+R\+Q handler. \end{DoxyCompactList}\item 
void \hyperlink{main_8c_a359616b69ef6be09a3cb5680893c25cb}{ms\+\_\+sleep} (int time)
\begin{DoxyCompactList}\small\item\em Sleep in millisecond durations. \end{DoxyCompactList}\item 
void \hyperlink{main_8c_a42ca7c9b89c22fcd9ec9aeed3e96b6c4}{get\+\_\+system\+\_\+time\+\_\+blocking} (struct \hyperlink{structsw__timer__system__time}{sw\+\_\+timer\+\_\+system\+\_\+time} $\ast$result)
\begin{DoxyCompactList}\small\item\em Get time, wait until an atomic reading was successful. \end{DoxyCompactList}\item 
void \hyperlink{main_8c_ac10cd1ff6b8d3726905397fc86b44bb1}{set\+\_\+status\+\_\+color} (int r, int g, int b)
\begin{DoxyCompactList}\small\item\em Update status L\+E\+D. \end{DoxyCompactList}\item 
int \hyperlink{main_8c_a840291bc02cba5474a4cb46a9b9566fe}{main} (void)
\begin{DoxyCompactList}\small\item\em Application entry point. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
volatile int \hyperlink{main_8c_ad6626ba12fbadd1981081605f892a7bb}{sleep\+\_\+ms} = 0
\begin{DoxyCompactList}\small\item\em Holds number of ms to sleep, counts down in \hyperlink{main_8c_afdd94f850b193691f1bfc60c724b542a}{sys\+\_\+tick\+\_\+handler()} \end{DoxyCompactList}\item 
\hypertarget{main_8c_a2d39b8e4f9506f28e2bdff70929287f6}{}volatile int {\bfseries N\+T\+C\+\_\+filtered\+\_\+value} = -\/1\label{main_8c_a2d39b8e4f9506f28e2bdff70929287f6}

\item 
\hypertarget{main_8c_a9d12c8106f421683f94175dd1c572624}{}volatile struct \hyperlink{structsw__timer__system__time}{sw\+\_\+timer\+\_\+system\+\_\+time} {\bfseries system\+\_\+time} = \{1420070400, 0\}\label{main_8c_a9d12c8106f421683f94175dd1c572624}

\item 
\hypertarget{main_8c_a153e3e14841d1967017a21ab4feacc19}{}volatile bool {\bfseries system\+\_\+time\+\_\+updated} =0\label{main_8c_a153e3e14841d1967017a21ab4feacc19}

\end{DoxyCompactItemize}


\subsection{Detailed Description}
Irrigation controller main file. 

\begin{DoxyRefDesc}{Todo}
\item[\hyperlink{todo__todo000005}{Todo}]systick, adc, moisture sensor, pwm output, filter 

explain port and rcc better\end{DoxyRefDesc}


\subsection{Macro Definition Documentation}
\hypertarget{main_8c_a3c3fdab7e413cd726f82bfba92630a39}{}\index{main.\+c@{main.\+c}!H\+W\+\_\+\+P\+R\+E\+\_\+\+I\+N\+I\+T@{H\+W\+\_\+\+P\+R\+E\+\_\+\+I\+N\+I\+T}}
\index{H\+W\+\_\+\+P\+R\+E\+\_\+\+I\+N\+I\+T@{H\+W\+\_\+\+P\+R\+E\+\_\+\+I\+N\+I\+T}!main.\+c@{main.\+c}}
\subsubsection[{H\+W\+\_\+\+P\+R\+E\+\_\+\+I\+N\+I\+T}]{\setlength{\rightskip}{0pt plus 5cm}\#define H\+W\+\_\+\+P\+R\+E\+\_\+\+I\+N\+I\+T(
\begin{DoxyParamCaption}
\item[{}]{call, }
\item[{}]{obj}
\end{DoxyParamCaption}
)}\label{main_8c_a3c3fdab7e413cd726f82bfba92630a39}
{\bfseries Value\+:}
\begin{DoxyCode}
call(obj, \hyperlink{hw_8h_a3c02952100e7d051b77cdf060ca0ba9baca0b4dbf0e3911b3edde56d700f76ecf}{HW\_INIT\_RCC});\(\backslash\)
    call(obj, \hyperlink{hw_8h_a3c02952100e7d051b77cdf060ca0ba9ba4e9b2d4b7e946d95c2e41f3de17035a0}{HW\_INIT\_GPIO});\(\backslash\)
    call(obj, \hyperlink{hw_8h_a3c02952100e7d051b77cdf060ca0ba9ba45012c00c17031e71a4f60ada04df07d}{HW\_INIT\_PRE\_NVIC});\(\backslash\)
    call(obj, \hyperlink{hw_8h_a3c02952100e7d051b77cdf060ca0ba9ba3f137ea5dd6b2ac372bb6d175434b3fa}{HW\_INIT\_NVIC});\(\backslash\)
    call(obj, \hyperlink{hw_8h_a3c02952100e7d051b77cdf060ca0ba9bacf9b04dc351d9fc47482fcd5229eb201}{HW\_INIT\_POST\_INIT});
\end{DoxyCode}


Definition at line 16 of file main.\+c.



\subsection{Function Documentation}
\hypertarget{main_8c_a42ca7c9b89c22fcd9ec9aeed3e96b6c4}{}\index{main.\+c@{main.\+c}!get\+\_\+system\+\_\+time\+\_\+blocking@{get\+\_\+system\+\_\+time\+\_\+blocking}}
\index{get\+\_\+system\+\_\+time\+\_\+blocking@{get\+\_\+system\+\_\+time\+\_\+blocking}!main.\+c@{main.\+c}}
\subsubsection[{get\+\_\+system\+\_\+time\+\_\+blocking}]{\setlength{\rightskip}{0pt plus 5cm}void get\+\_\+system\+\_\+time\+\_\+blocking (
\begin{DoxyParamCaption}
\item[{struct {\bf sw\+\_\+timer\+\_\+system\+\_\+time} $\ast$}]{result}
\end{DoxyParamCaption}
)}\label{main_8c_a42ca7c9b89c22fcd9ec9aeed3e96b6c4}


Get time, wait until an atomic reading was successful. 



Definition at line 97 of file main.\+c.



Referenced by main().

\hypertarget{main_8c_aabae29cd362c0001a2b417c9206cb330}{}\index{main.\+c@{main.\+c}!hw\+\_\+init\+\_\+state@{hw\+\_\+init\+\_\+state}}
\index{hw\+\_\+init\+\_\+state@{hw\+\_\+init\+\_\+state}!main.\+c@{main.\+c}}
\subsubsection[{hw\+\_\+init\+\_\+state}]{\setlength{\rightskip}{0pt plus 5cm}void {\bf hw\+\_\+init\+\_\+state} (
\begin{DoxyParamCaption}
\item[{enum {\bf hw\+\_\+init\+\_\+state}}]{state}
\end{DoxyParamCaption}
)}\label{main_8c_aabae29cd362c0001a2b417c9206cb330}


Init hardware. 

This function prototype calls all perhipherals with the state as argument. 

Definition at line 64 of file main.\+c.



References usart\+\_\+init(), and ws2812\+\_\+init().

\hypertarget{main_8c_a840291bc02cba5474a4cb46a9b9566fe}{}\index{main.\+c@{main.\+c}!main@{main}}
\index{main@{main}!main.\+c@{main.\+c}}
\subsubsection[{main}]{\setlength{\rightskip}{0pt plus 5cm}int main (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}\label{main_8c_a840291bc02cba5474a4cb46a9b9566fe}


Application entry point. 



Definition at line 117 of file main.\+c.



References get\+\_\+system\+\_\+time\+\_\+blocking(), hw\+\_\+init(), ms\+\_\+sleep(), set\+\_\+status\+\_\+color(), usart\+\_\+blocking\+\_\+str, and usart\+\_\+blocking\+\_\+tm().

\hypertarget{main_8c_a359616b69ef6be09a3cb5680893c25cb}{}\index{main.\+c@{main.\+c}!ms\+\_\+sleep@{ms\+\_\+sleep}}
\index{ms\+\_\+sleep@{ms\+\_\+sleep}!main.\+c@{main.\+c}}
\subsubsection[{ms\+\_\+sleep}]{\setlength{\rightskip}{0pt plus 5cm}void ms\+\_\+sleep (
\begin{DoxyParamCaption}
\item[{int}]{time}
\end{DoxyParamCaption}
)}\label{main_8c_a359616b69ef6be09a3cb5680893c25cb}


Sleep in millisecond durations. 



Definition at line 91 of file main.\+c.



References sleep\+\_\+ms.



Referenced by main().

\hypertarget{main_8c_ac10cd1ff6b8d3726905397fc86b44bb1}{}\index{main.\+c@{main.\+c}!set\+\_\+status\+\_\+color@{set\+\_\+status\+\_\+color}}
\index{set\+\_\+status\+\_\+color@{set\+\_\+status\+\_\+color}!main.\+c@{main.\+c}}
\subsubsection[{set\+\_\+status\+\_\+color}]{\setlength{\rightskip}{0pt plus 5cm}void set\+\_\+status\+\_\+color (
\begin{DoxyParamCaption}
\item[{int}]{r, }
\item[{int}]{g, }
\item[{int}]{b}
\end{DoxyParamCaption}
)}\label{main_8c_ac10cd1ff6b8d3726905397fc86b44bb1}


Update status L\+E\+D. 



Definition at line 110 of file main.\+c.



References ws2812\+\_\+set\+\_\+led(), and ws2812\+\_\+update\+\_\+blocking().



Referenced by main().

\hypertarget{main_8c_afdd94f850b193691f1bfc60c724b542a}{}\index{main.\+c@{main.\+c}!sys\+\_\+tick\+\_\+handler@{sys\+\_\+tick\+\_\+handler}}
\index{sys\+\_\+tick\+\_\+handler@{sys\+\_\+tick\+\_\+handler}!main.\+c@{main.\+c}}
\subsubsection[{sys\+\_\+tick\+\_\+handler}]{\setlength{\rightskip}{0pt plus 5cm}void sys\+\_\+tick\+\_\+handler (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}\label{main_8c_afdd94f850b193691f1bfc60c724b542a}


Systick I\+R\+Q handler. 



Definition at line 77 of file main.\+c.



References sw\+\_\+timer\+\_\+system\+\_\+time\+::epoch, sw\+\_\+timer\+\_\+system\+\_\+time\+::ms, and sleep\+\_\+ms.



\subsection{Variable Documentation}
\hypertarget{main_8c_ad6626ba12fbadd1981081605f892a7bb}{}\index{main.\+c@{main.\+c}!sleep\+\_\+ms@{sleep\+\_\+ms}}
\index{sleep\+\_\+ms@{sleep\+\_\+ms}!main.\+c@{main.\+c}}
\subsubsection[{sleep\+\_\+ms}]{\setlength{\rightskip}{0pt plus 5cm}volatile int sleep\+\_\+ms = 0}\label{main_8c_ad6626ba12fbadd1981081605f892a7bb}


Holds number of ms to sleep, counts down in \hyperlink{main_8c_afdd94f850b193691f1bfc60c724b542a}{sys\+\_\+tick\+\_\+handler()} 



Definition at line 59 of file main.\+c.



Referenced by ms\+\_\+sleep(), and sys\+\_\+tick\+\_\+handler().

